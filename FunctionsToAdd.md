# Functions to add to the server or webpage
## Communication between a unit and main server
The communication between a unit (ESP-32) and the main server are using socket.io. 
The first message from the unit after the connection has been established needs to be the passcode in the following format:
       
    'authentication': passcode (str)

The unit will receive the following message as replay if the passcode is correct:

    'authentication': true (bool)

And if the passcode is wrong:

    'authentication': false (bool)
    
When the unit has  been authenticated it can start transmitting sensor data to the server in the following format:

    'temperatureSensor': sensorData
    
Where sensorData is formatted in JSON and need to include the unitId as a number between 000 and 999, 
sensorId as a number between 000 and 999 and 
temperature as a number between -50 and 250 (degrees celsius). 
See the example below. (You are NOT required to include the zeroes.)

    {
    "unitId": 001,
    "sensorId": 001,
    "temperature": 25,
    }
    
    
## Server

### Saving data to Firebase
The server sends all sensor data received to the Firebase realtime database. The server adds a timestamp to the sensor data.
The structure of the database is like the example below:

    {
        "timestamps": {
            "1603573636239": {
                "unitId": "1",
                "senorId": "1",
                "temperature": "24.3",
            },
            "16035736374208": {
                 "unitId": "1",
                 "senorId": "1",
                 "temperature": "25.3",   
            }
    } 
    
    {
            "SenorID": {
                "uniqe ID": {
                  "timestamp": 132321412,
                    "temperature": "24.3",
                },{
                     "timestamp": 3423,
                     "temperature": "25.3",
                   },
                
                "16035736374208": {
                     "unitId": "1",
                     "senorId": "1",
                     "temperature": "25.3",   
                }
        } 

### Authentication and security
Need an ability to authenticate a user, or unit (ESP-32). This can be done by a user specific randomly generated passcode. 
For example using a 16 character long string generated by the server, and then whitelist the unit using this passcode. 
This means the first communication from a unit (ESP-32) to the server has to be the 'passcode'. Or else the server will block (blacklist) the communication from that ip. 

This is only for communication to the main server, not the webserver that is running on a different port.   

An alternative is to have one passcode per user. This can produce a security hole, unless all the "links" are secure (ssl).
## Webpage

### Generate a passcode for a unit
There need to be an option to generate a new passcode for a new unit, when a user has logged in.
This can for example be a button (new unit), that when pressed asks the main server for a new passcode and displays it in a window.
 
Se entry [Authentication and security](#Authentication and security) for specific information.
 